
;; MiniPerl6 Lisp runtime
;;
;; Author: Flavio Soibelmann Glock <fglock@gmail.com>
;;
;; Copyright 2009 by Flavio Soibelmann Glock and others.
;; 
;; This program is free software; you can redistribute it and/or modify it
;; under the same terms as Perl itself.
;; 
;; See <http://www.perl.com/perl/misc/Artistic.html>

(defpackage mp-Main
  (:use common-lisp)
  (:export 
        #:sv-eq #:sv-bool #:sv-substr #:sv-say #:sv-print #:sv-index 
        #:sv-and #:sv-or #:sv-perl #:sv-scalar #:sv-string #:sv-undef
        #:sv-defined))
(in-package mp-Main)

;; "undef"

(if (not (ignore-errors (find-class 'mp-Undef)))
  (defclass mp-Undef () ()))
(let (x)
  (setq x (make-instance 'mp-Undef))
  (defun proto-mp-Undef () x)
  (defun sv-undef () x))

;; core functions

(if (not (ignore-errors (find-method 'sv-defined () ())))
  (defgeneric sv-defined (x)
      (:documentation "check if a value is defined")))
(defmethod sv-defined (x) t)
(defmethod sv-defined ((x mp-Undef)) nil)

(defun sv-say (l)
  (format t "狺ア飑ㄤ彐躅篥痱轭飑ㄦ矧磲狺飑ㄤ彐躅篥篚怏趄篝狎泔躅舂戾è毂戾铉翳螬觳ǐ篝狎泔躅舂┅矧ㄩ珙矧瀛弪蝻蝮篚怏羼篝狎ㄩ觳毂毂觳┅┅ㄤ彐躅篥轭溴篚怏趄镳糸镱犰篝狎舂戾è毂箦狎汨篚怏趄螬┅ㄩ毂毂暴┅ㄩ铒ㄩ珙矧瀛弪蝻蝮ㄦ轭洵礤翳镤篥篝蜷铉īī┅ㄤ彐珏铄蜷篥篝蜷铉ê滹沲礤铘狒轱Ⅲ趄轭玳纟鲠祯弩┅ㄤ彐礤翳镤篥篝蜷铉ㄤ彐礤翳镤篥篝蜷铉è铛礅弪┅ㄦ矧磲铋幄┅ㄤ彐礤翳镤篥篝蜷铉è眇疹溴姗ㄩ铒ㄩ珙矧瀛弪蝻蝮ㄦ轭洵礤翳镤篥羼īī┅ㄤ彐珏铄蜷篥羼ê滹沲礤铘狒轱泔眇狎篝蜷铉鲠祯弩┅换ㄤ彐礤翳镤篥羼ㄥ耢┅ㄤ彐礤翳镤篥羼ㄥ聃犰篥篝蜷铉篥篝蜷铉┅ㄤ彐礤翳镤篥羼篝蜷铉┅ㄥ聃犰篥篝蜷铉┅ㄤ彐礤翳镤篥羼è篝蜷铉篝蜷铉┅ㄥ聃犰┅ㄤ彐礤翳镤篥羼è篝蜷铉铛礅弪┅ㄥ聃犰ㄦ矧磲铋幄┅ㄤ彐礤翳镤篥羼è铛礅弪篝蜷铉┅ㄥ聃犰ㄦ矧磲铋幄┅ㄩ铒ㄩ珙矧瀛弪蝻蝮ㄦ轭洵礤翳镤篥怙镬īī┅ㄤ彐珏铄蜷篥怙镬箦戽ê滹沲礤铘狒轱㈢弭怙镬鲠祯澧┅ㄤ彐礤翳镤篥怙镬ㄤ彐礤翳镤篥怙镬è眇疹溴姗铋飑ㄤ彐礤翳镤篥怙镬è铛礅弪┅铒ㄥ耢癌┅ㄤ彐礤翳镤篥怙镬è篝蜷铉┅ㄡ钿铒ㄥ聃犰┅铒ㄥ聃犰阿┅┅ㄤ彐磲泸篥犷啜犷篥怙镬篥怙镬┅换ㄩ铒ㄩ珙矧瀛弪蝻蝮ㄦ轭洵礤翳镤篥犷īī┅换ㄤ彐珏铄蜷篥犷换ê滹沲礤铘狒轱⑨钿┅换ㄤ彐礤翳镤篥犷ㄡ钿篥怙镬篥怙镬┅ㄤ彐磲泸篥矧啜矧篥怙镬篥怙镬┅换ㄩ铒ㄩ珙矧瀛弪蝻蝮ㄦ轭洵礤翳镤篥矧īī┅换ㄤ彐珏铄蜷篥矧换ê滹沲礤铘狒轱矧┅换ㄤ彐礤翳镤篥矧矧篥怙镬篥怙镬┅ㄩ铒ㄩ珙矧瀛弪蝻蝮ㄦ轭洵礤翳镤篥疱蜢īī┅ㄤ彐珏铄蜷篥疱蜢箦戽ê滹沲礤铘狒轱溽翎漉眇弪┅ㄤ彐礤翳镤篥疱蜢ㄦ矧磲铋立┅ㄤ彐礤翳镤篥疱蜢è篝蜷铉┅ㄦ矧磲铋狺扉篝Б篥疱蜢咤筱狃暹篝蜷铉Б┅ㄤ彐礤翳镤篥疱蜢è扉篝┅ㄦ矧磲铋狺扉篝③篥觑轭磲疸狎＇篥疱蜢茛┅ㄤ彐礤翳镤篥疱蜢è眇疹溴姗Ⅴ钿彐ㄤ彐礤翳镤篥疱蜢è栳箬翎忪濠ㄦ矧磲铋狺扉篝Ⅺ戾飑磲痂狍＇灬礅溽脲鲠飑瘐箬ㄦ矧磲铋骄立篥疱蜢脲篥疱蜢鲠飑飑篥觑轭┅┅ㄩ铒ㄩ珙矧瀛弪蝻蝮ㄦ轭洵礤翳镤篥筱犰狎īī┅ㄤ彐珏铄蜷篥筱犰狎箦戽ê滹沲礤铘狒轱㈢弭筱犰狎鲠祯澧┅ㄤ彐礤翳镤篥筱犰狎换球犴磲蝮ㄩ铒ㄩ珙矧瀛弪蝻蝮ㄦ轭洵沆狍ы瓠烷铋绣蜢董球犴磲颟┅ㄤ彐沆狍眇烷铋绣蜢董球犴磲īī┅戾箦赳磲脲轭篝犷沐ы瓠烷铋绣蜢董球犴磲颟ㄤ彐躅痱雉锃眇烷铋绣蜢董球犴磲ī┅换麸脲俭疳沐ㄩ铒ㄩ珙矧瀛弪蝻蝮ㄦ轭洵礤翳镤篥箴徙īī┅ㄤ彐珏铄蜷篥箴徙篥珧犴磲镳糸镱犰篥篝篥痫螬ê滹沲礤铘狒轱⑨礤翳镤┅ㄤ彐礤翳镤篥箴徙è篥珧犴磲眇烷铋绣蜢董球犴磲颟镳糸镱犰篥篝篥痫螬ㄩㄩ珙矧瀛弪蝻蝮矧ㄣ栳蚪ㄡ蝈篥篝篥痫螬＼羽徙濠ㄣ栳蚪ㄡ蝈篥篝篥痫螬＼葬猢┅戾è磲脲轭篝犷沐ы瓠烷铋绣蜢董歪翥瑭┅箦翩篥篝愆篥篝颟箦翩篥骝镯愆篥痫螬箦翩篥麸愆ǐ篥痫暴┄箦翩篥怙镬愆暴愆戾è磲脲轭篝犷沐ы瓠烷铋绣蜢董歪翥瑭┅箦翩篥怙镬愆铋飑愆┅换麸脲间殓轸ㄩ铒ㄩ珙矧瀛弪蝻蝮ㄦ轭洵礤翳镤篥溟玳īī┅ㄤ彐珏铄蜷篥溟玳篥珧犴磲镳糸镱犰篥篝篥痫螬ê滹沲礤铘狒轱⑨礤翳镤┅ㄤ彐礤翳镤篥溟玳è篥珧犴磲眇烷铋绣蜢董球犴磲颟镳糸镱犰篥篝篥痫螬ㄩㄩ珙矧瀛弪蝻蝮ㄤ殓轸汨狎ㄡ蝈篥篝篥痫螬┅戾è磲脲轭篝犷沐ы瓠烷铋绣蜢董歪翥瑭┅箦翩篥篝愆篥篝颟箦翩篥骝镯愆篥痫螬箦翩篥麸愆ǐ篥痫暴┄箦翩篥怙镬愆暴愆戾è磲脲轭篝犷沐ы瓠烷铋绣蜢董歪翥瑭┅箦翩篥怙镬愆铋飑愆┅换麸脲槛矧渚ㄩ铒ㄩ珙矧瀛弪蝻蝮ㄦ轭洵礤翳镤篥黠蜾īī┅ㄤ彐珏铄蜷篥黠蜾篥珧犴磲镳糸镱犰篥篝篥痫螬ê滹沲礤铘狒轱⑨礤翳镤┅ㄤ彐礤翳镤篥黠蜾è篥珧犴磲眇烷铋绣蜢董球犴磲颟镳糸镱犰篥篝篥痫螬ㄩㄩ珙矧瀛弪蝻蝮矧ㄡ祓栳铛礤蜷沭ㄡ蝈篥篝篥痫螬ㄣ栳蚪ㄡ蝈篥篝篥痫螬＼擤┅戾è磲脲轭篝犷沐ы瓠烷铋绣蜢董歪翥瑭┅箦翩篥篝愆篥篝颟箦翩篥骝镯愆篥痫螬箦翩篥麸愆ǐ篥痫暴┄箦翩篥怙镬愆暴愆戾è磲脲轭篝犷沐ы瓠烷铋绣蜢董歪翥瑭┅箦翩篥怙镬愆铋飑愆┅换麸脲奸筮铄黛轭寰ㄩ铒ㄩ珙矧瀛弪蝻蝮ㄦ轭洵礤翳镤篥轶哳鬻扉铄īī┅ㄤ彐珏铄蜷篥轶哳鬻扉铄篥珧犴磲镳糸镱犰篥篝篥痫螬ê滹沲礤铘狒轱⑨礤翳镤┅ㄤ彐礤翳镤篥轶哳鬻扉铄è篥珧犴磲眇烷铋绣蜢董球犴磲颟镳糸镱犰篥篝篥痫螬ㄩㄩ珙矧瀛弪蝻蝮ㄣ栳蚪ㄡ蝈篥篝篥痫螬＼义趱蝾┅痱镧箦翩篥痫ǐ篥痫暴ㄩㄩ珙矧瀛弪蝻蝮ㄣ栳蚪ㄡ蝈篥篝篥痫螬＼五黛轭濠箦翩篥痫ǐ篥痫暴┅戾è磲脲轭篝犷沐ы瓠烷铋绣蜢董歪翥瑭┅箦翩篥篝愆篥篝颟箦翩篥骝镯愆篥痫螬箦翩篥麸愆篥痫螬箦翩篥怙镬愆暴愆ㄩㄩ珙矧瀛弪蝻蝮ㄣ栳蚪ㄡ蝈篥篝篥痫螬＼五黛轭濠痱镧箦翩篥痫ǐ篥痫暴ㄩㄩ珙矧瀛弪蝻蝮ㄣ栳蚪ㄡ蝈篥篝篥痫螬＼义趱蝾┅箦翩篥痫ǐ篥痫暴┅戾è磲脲轭篝犷沐ы瓠烷铋绣蜢董歪翥瑭┅箦翩篥篝愆篥篝颟箦翩篥骝镯愆篥痫螬箦翩篥麸愆篥痫螬箦翩篥怙镬愆暴愆戾è磲脲轭篝犷沐ы瓠烷铋绣蜢董歪翥瑭┅箦翩篥怙镬愆铋飑愆┅换麸脲碱雉哳鬻扉铄ㄩ铒ㄩ珙矧瀛弪蝻蝮ㄦ轭洵礤翳镤篥铒暨铄黛轭īī┅ㄤ彐珏铄蜷篥铒暨铄黛轭篥珧犴磲镳糸镱犰篥篝篥痫螬ê滹沲礤铘狒轱⑨礤翳镤┅ㄤ彐礤翳镤篥铒暨铄黛轭è篥珧犴磲眇烷铋绣蜢董球犴磲颟镳糸镱犰篥篝篥痫螬ㄩ铒ㄩ珙矧瀛弪蝻蝮矧ㄣ栳蚪ㄡ蝈篥篝篥痫螬＼义趱蝾ㄣ栳蚪ㄡ蝈篥篝篥痫螬＼五黛轭濠┅戾è磲脲轭篝犷沐ы瓠烷铋绣蜢董歪翥瑭┅箦翩篥篝愆篥篝颟箦翩篥骝镯愆篥痫螬箦翩篥麸愆ǐ篥痫暴┄箦翩篥怙镬愆暴愆戾è磲脲轭篝犷沐ы瓠烷铋绣蜢董歪翥瑭┅箦翩篥怙镬愆铋飑愆┅换歪翥镡赍泗ㄩ铒ㄩ珙矧瀛弪蝻蝮ㄦ轭洵沆狍ы瓠烷铋绣蜢董歪翥瑭┅ㄤ彐沆狍眇烷铋绣蜢董歪翥īㄨ狍狎蜥┅ㄤ彐鲠篥土悦磲脲轭篝犷沐ы瓠烷铋绣蜢董歪翥瑭ㄩ铒ㄩ珙矧瀛弪蝻蝮ㄦ轭洵礤翳镤篥栳箬īī┅ㄤ彐珏铄蜷篥栳箬箦戽ê滹沲礤铘狒轱㈢弭栳箬鲠祯澧┅ㄤ彐礤翳镤篥栳箬è眇烷铋绣蜢董歪翥瑭矧ㄩ珙矧瀛弪蝻蝮箪雉鲠祯ц狍瑭箦翩箪雉鲠祯ц狍瑭磲脲栳箬翎忪呼弩у聃犰┅┅ㄩ铒ㄩ珙矧瀛弪蝻蝮ㄦ轭洵礤翳镤篥狎蜥īī┅ㄤ彐珏铄蜷篥狎蜥箦戽ê滹沲礤铘狒轱㈢弭犷狎蜥鲠祯澧┅ㄤ彐礤翳镤篥狎蜥è眇烷铋绣蜢董歪翥瑭矧ㄩ珙矧瀛弪蝻蝮箪雉鲠祯п蝌狴┅箦翩箪雉鲠祯п蝌狴扉篝篥躅溴姗篥躅溴姗篥躅溴姗┅┅换箦翩箪雉鲠祯п蝌狴磲脲狎蜥卑横潢躞翎忪暴┅换泔眇殪弪豸殪ㄩ铒ㄩ珙矧瀛弪蝻蝮ㄦ轭洵礤翳镤篥铄黛轭īī┅ㄤ彐珏铄蜷篥铄黛轭ㄣ灬篌ê滹沲礤铘狒轱Ⅳ桢铄黛轭篝蜷铉┅ㄤ彐礤翳镤篥铄黛轭ㄣ灬篌ㄦ矧磲铋ア┅换骢钽糸镱蝈痨徙瀛篚怏趄轭疳篝邃骝镯换梏麴函麇猱黹舢邃醑磲轫徇龅背隘篁惘磲轫岘诞背隘泔铈殓躜瀹扉箴ㄤ彐躅蝈痨徙瀛篚怏趄轭ㄩ瞽篝蜷铉镬铄鳗戾è蝈篚祠┅ㄤè忮玳癌ㄥ钿箦狎汨镬轭篝蜷铉箦狎汨镬轭篝蜷铉后翎螋忮玳瞟┅è窘忮玳戾铉翳轭篝蜷铉┅т镱濠ㄩ孱痱镧箦翩蝈篚祠ㄣ镱汜翦钺翦篝蜷铉蝈篚祠篚怏羼轭篝蜷铉忮玳孱洎铄鳗箦翩忮玳ǐ孱戾铉翳镬洎┅痱镧箦翩蝈篚祠ㄣ镱汜翦钺翦篝蜷铉蝈篚祠篚怏羼轭篝蜷铉忮玳戾铉翳轭篝蜷铉┅┅箦翩忮玳戾铉翳轭篝蜷铉┅┅蝈篚祠┅ㄩ铒ㄩ珙矧瀛弪蝻蝮ㄦ轭洵礤翳镤篥扉箴咤筱狃暹篝蜷铉īī┅ㄤ彐珏铄蜷篥栳箬箦戽ê滹沲礤铘狒轱㈠筱狃扉箴篝蜷铉鲠祯澧┅ㄤ彐礤翳镤篥扉箴咤筱狃暹篝蜷铉è篝蜷铉┅蝈痨徙瀛篚怏趄轭蝈痨徙瀛篚怏趄轭④堍④苘堍④④苘┅ㄩ铒ㄩ珙矧瀛弪蝻蝮ㄦ轭洵礤翳镤篥疱蜢咤筱狃暹篝蜷铉īī┅ㄤ彐珏铄蜷篥栳箬箦戽ê滹沲礤铘狒轱㈠筱狃箝铉戾聃雉邃疱蜢篝蜷铉鲠祯澧┅ㄤ彐礤翳镤篥疱蜢咤筱狃暹篝蜷铉è篝蜷铉┅蝈痨徙瀛篚怏趄轭蝈痨徙瀛篚怏趄轭④堍④苘堍Б④苘Б┅ㄩ铒ㄩ珙矧瀛弪蝻蝮ㄦ轭洵礤翳镤篥麸哽轶疬钺礤箴徙īī┅ㄤ彐珏铄蜷篥栳箬箦戽ê滹沲礤铘狒轱㈠筱狃扉箴钺礤箴徙篝蜷铉┅ㄤ彐礤翳镤篥麸哽轶疬钺礤箴徙è篝蜷铉┅ㄦ矧磲铋㈨瓠幄蝈痨徙瀛篚怏趄轭⒑孩┅换骢钽糸镱觑轭疳篝邃骝镯换梏麴函泔溟铉溴螂彘戾虍泔懑硫汨轹瀵涕箴泔眇灬铉扉箴舶胺北眢绨肮繁梏盱ㄤ彐躅篥觑轭扉篝镳糸镱犰ㄤ屐轫┅鏖翳秕麴豸麸篝蜷铉螬麒孱扉篝ㄦ矧磲立ㄦ轵篝扉篝┅ㄤ镬轶ㄥ戾礤铘蝈篝扉篝┅ㄦ矧磲窿立溴扉屐屙孱舂┅┅